<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quay S·ªë L√¨ X√¨</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
       body {
    background: url('anhbia.png') no-repeat center center fixed;
    background-size: cover;
    text-align: center;
    padding: 50px;
    font-family: 'Poppins', sans-serif;
    color: #fff;
}

.container {
    max-width: 600px;
    margin: auto;
    background: rgba(255, 255, 255, 0.9); /* Gi·ªØ n·ªÅn m·ªù */
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 0 25px rgba(0,0,0,0.3);
    border: 6px solid #d0021b;
    animation: fadeIn 1.5s ease-in-out;
}

@keyframes fadeIn {
    0% { opacity: 0; transform: scale(0.9); }
    100% { opacity: 1; transform: scale(1); }
}

h1 {
    font-family: 'Pacifico', cursive;
    font-size: 50px;
    color: #d0021b;
    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.3);
    animation: bounce 2s infinite;
}

@keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(-10px); }
}

.btn-primary, .btn-success {
    font-weight: bold;
    font-size: 22px;
    border-radius: 15px;
    padding: 15px 30px;
    background: linear-gradient(90deg, #ff4b2b, #ff416c);
    color: #fff;
    border: none;
    transition: all 0.3s ease-in-out;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
}

.btn-primary:hover, .btn-success:hover {
    transform: scale(1.1);
    background: linear-gradient(90deg, #ff416c, #ff4b2b);
}

#result {
    font-size: 26px;
    font-weight: bold;
    color: #28a745;
    background: rgba(255, 255, 255, 0.9);
    padding: 20px;
    border-radius: 15px;
    border: 4px solid #28a745;
    margin-top: 20px;
    box-shadow: 0 0 20px rgba(0,0,0,0.2);
    display: none;
    animation: fadeIn 1s ease-in-out;
}

.lucky-spin {
    animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* Hi·ªÉn th·ªã danh s√°ch ng∆∞·ªùi nh·∫≠n th∆∞·ªüng v·ªõi hi·ªáu ·ª©ng s·ªëng ƒë·ªông */
#recentWinners {
    position: fixed;
    top: 10%;
    left: 50%;
    transform: translateX(-50%);
    width: 80%;
    pointer-events: none;
    z-index: 1000;
}

.winner-item {
    position: absolute;
    font-size: 24px;
    font-weight: bold;
    color: #000; /* Ch·ªØ ƒëen d·ªÖ ƒë·ªçc */
    white-space: nowrap;
    opacity: 0;
    animation: fadeMove 12s linear forwards;
    text-shadow: 2px 2px 5px rgba(255, 255, 255, 0.9);
}

@keyframes fadeMove {
    0% {
        left: 100%;
        opacity: 0;
    }
    10% {
        opacity: 1;
    }
    90% {
        opacity: 1;
    }
    100% {
        left: -100%;
        opacity: 0;
    }
}

/* Hi·ªáu ·ª©ng ph√°o hoa */
.fireworks {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    pointer-events: none;
}

.fireworks span {
    position: absolute;
    top: 50%;
    left: 50%;
    width: 8px;
    height: 8px;
    background: #ff0;
    border-radius: 50%;
    animation: explode 1.5s ease-out infinite;
}

@keyframes explode {
    0% { transform: scale(1); opacity: 1; }
    100% { transform: scale(10); opacity: 0; }
}

    </style>
</head>
<body>
    <div class="container">
        <h1 class="mb-4">Ch√∫c M·ª´ng NƒÉm M·ªõi!</h1>
        <p class="mb-4" style="color: black;">Nh·∫•n v√†o n√∫t d∆∞·ªõi ƒë√¢y ƒë·ªÉ nh·∫≠n l·∫•y con s·ªë may m·∫Øn c·ªßa b·∫°n!</p>
        <button id="spinBtn" class="btn btn-primary lucky-spin">üéÅ Quay S·ªë Ngay</button>
        <div id="result" class="mt-4">
            <p>üéâ Ch√∫c m·ª´ng! B·∫°n s·∫Ω nh·∫≠n ƒë∆∞·ª£c: <span id="luckyNumber" class="fw-bold text-danger"></span> VNƒê ti·ªÅn l√¨ x√¨ t·ª´ DanhLo üéâ</p>
            <button class="btn btn-success" onclick="submitLuckyNumber()">üí∞ Nh·∫≠n L√¨ X√¨</button>
        </div>
    </div>
    <div id="recentWinners"></div>
    <audio id="bg-music" loop>
        <source src="./nhactet.mp3" type="audio/mpeg">
    </audio>

    <script>
        document.getElementById('spinBtn').addEventListener('click', function() {
            let spinBtn = document.getElementById('spinBtn');
            if (spinBtn.disabled) return;

            spinBtn.disabled = true;
            spinBtn.classList.remove('lucky-spin');
            spinBtn.innerText = "üéâ ƒê√£ Quay!";

            let luckyNumber;
            let random = Math.random();

            if (random < 0.8) {
                luckyNumber = Math.floor(Math.random() * 40) + 1;
            } else if (random < 0.95) {
                luckyNumber = Math.floor(Math.random() * 20) + 41;
            } else {
                luckyNumber = Math.floor(Math.random() * 40) + 61;
            }

            document.getElementById('luckyNumber').innerText = luckyNumber * 1000;
            document.getElementById('result').style.display = "block";
        });

        function submitLuckyNumber() {
    const scriptURL = "https://script.google.com/macros/s/AKfycbxqb5cXO7EDVbCLLZlWWOeVeGUHRwYr-Aa6-y9fllpgqo3npQoIVZoA_aGErQSuNd3i/exec";

    const name = localStorage.getItem('name'); // L·∫•y t√™n t·ª´ localStorage
    const luckyNumber = document.getElementById('luckyNumber').innerText;

    if (!name || !luckyNumber) {
        alert("Kh√¥ng c√≥ d·ªØ li·ªáu h·ª£p l·ªá. Vui l√≤ng th·ª≠ l·∫°i!");
        return;
    }

    const formData = new FormData();
    formData.append('action', 'update');  // H√†nh ƒë·ªông c·∫≠p nh·∫≠t
    formData.append('name', name);  // G·ª≠i t√™n ƒë·ªÉ t√¨m ƒë√∫ng h√†ng
    formData.append('amount', luckyNumber);  // G·ª≠i s·ªë ti·ªÅn l√¨ x√¨

    fetch(scriptURL, { method: 'POST', body: formData })
        .then(response => response.text())
        .then(result => {
            if (result.trim() === "SUCCESS") {
                alert("L√¨ x√¨ c·ªßa b·∫°n ƒë√£ ƒë∆∞·ª£c c·∫≠p nh·∫≠t!");
                localStorage.clear();
                window.location.href = "index.html";  // Quay l·∫°i trang ch·ªß sau khi ho√†n t·∫•t
            } else if (result.trim() === "NOT FOUND") {
                alert("Kh√¥ng t√¨m th·∫•y th√¥ng tin ng∆∞·ªùi nh·∫≠n. Vui l√≤ng ki·ªÉm tra l·∫°i!");
            } else {
                alert("C√≥ l·ªói x·∫£y ra. Vui l√≤ng th·ª≠ l·∫°i!");
            }
        })
        .catch(error => {
            alert("L·ªói k·∫øt n·ªëi. Vui l√≤ng ki·ªÉm tra l·∫°i m·∫°ng!");
        });
}

function fetchWinners() {
        const sheetURL = "https://script.google.com/macros/s/AKfycbxqb5cXO7EDVbCLLZlWWOeVeGUHRwYr-Aa6-y9fllpgqo3npQoIVZoA_aGErQSuNd3i/exec";

        fetch(sheetURL)
            .then(response => response.json())
            .then(data => {
                let winnerContainer = document.getElementById('recentWinners');
                winnerContainer.innerHTML = ""; // X√≥a n·ªôi dung c≈©

                let validEntries = data.filter(entry => entry.name && entry.amount);
                let recentEntries = validEntries.slice(-10); // L·∫•y 10 ng∆∞·ªùi g·∫ßn nh·∫•t

                if (recentEntries.length === 0) {
                    return;
                }

                recentEntries.forEach((entry, index) => {
                    setTimeout(() => {
                        addFloatingWinner(entry.name, entry.amount);
                    }, index * 4000); // Hi·ªÉn th·ªã c√°ch nhau 4 gi√¢y
                });
            })
            .catch(error => {
                console.error("Kh√¥ng th·ªÉ t·∫£i d·ªØ li·ªáu t·ª´ Sheets", error);
            });
    }
   
    function addFloatingWinner(name, amount) {
        let winnerContainer = document.getElementById('recentWinners');
        let listItem = document.createElement('div');
        listItem.classList.add("winner-item");

        // Gi·ªõi h·∫°n v·ªã tr√≠ xu·∫•t hi·ªán trong ph·∫°m vi b·∫£ng ch√∫c m·ª´ng
        let randomTop = Math.random() * 20 + 20;  // Xu·∫•t hi·ªán ng·∫´u nhi√™n t·ª´ 20% ƒë·∫øn 40% chi·ªÅu cao m√†n h√¨nh
        listItem.style.top = `${randomTop}vh`;

        winnerContainer.appendChild(listItem);

        setTimeout(() => {
            listItem.remove();
        }, 10000);  // X√≥a ph·∫ßn t·ª≠ sau khi ho√†n th√†nh hi·ªáu ·ª©ng
    }

    setInterval(fetchWinners, 60000);
    fetchWinners();
   // Ch·ªù s·ª± ki·ªán click ƒë·ªÉ g·ª≠i t√≠n hi·ªáu ph√°t nh·∫°c ƒë·∫øn iframe
   document.addEventListener('click', function() {
        let musicFrame = document.getElementById('music-frame');
        if (musicFrame && musicFrame.contentWindow) {
            musicFrame.contentWindow.postMessage('play', '*');
            console.log("G·ª≠i t√≠n hi·ªáu ph√°t nh·∫°c");
        }
    });

    // Th√™m s·ª± ki·ªán d·ª´ng nh·∫°c
    document.addEventListener("DOMContentLoaded", function() {
    let audio = document.getElementById('bg-music');

    // Kh√¥i ph·ª•c th·ªùi gian ph√°t n·∫øu c√≥ l∆∞u tr∆∞·ªõc ƒë√≥
    if (localStorage.getItem('audioTime')) {
        audio.currentTime = parseFloat(localStorage.getItem('audioTime')) || 0;
    }

    // Ki·ªÉm tra xem nh·∫°c ƒë√£ t·ª´ng ph√°t hay ch∆∞a
    if (localStorage.getItem('isPlaying') === 'true') {
        audio.play().then(() => {
            console.log("Nh·∫°c ƒë√£ t·ª± ƒë·ªông ph√°t l·∫°i t·ª´ v·ªã tr√≠ tr∆∞·ªõc ƒë√≥.");
        }).catch(() => {
            console.log("Autoplay b·ªã ch·∫∑n, ch·ªù thao t√°c t·ª´ ng∆∞·ªùi d√πng.");

            // Ch·ªù ng∆∞·ªùi d√πng click v√†o b·∫•t k·ª≥ ƒë√¢u tr√™n trang ƒë·ªÉ ph√°t nh·∫°c
            document.addEventListener('click', function playAudioOnce() {
                audio.play();
                console.log("Nh·∫°c b·∫Øt ƒë·∫ßu ph√°t sau khi ng∆∞·ªùi d√πng t∆∞∆°ng t√°c.");
                document.removeEventListener('click', playAudioOnce);
            });
        });
    } else {
        // N·∫øu nh·∫°c ch∆∞a t·ª´ng ph√°t, th·ª≠ ph√°t l·∫ßn ƒë·∫ßu
        audio.play().then(() => {
            console.log("Nh·∫°c ƒë√£ t·ª± ƒë·ªông ph√°t l·∫ßn ƒë·∫ßu.");
            localStorage.setItem('isPlaying', 'true');
        }).catch(() => {
            console.log("Autoplay b·ªã ch·∫∑n, ch·ªù thao t√°c t·ª´ ng∆∞·ªùi d√πng.");
            document.addEventListener('click', function playAudioOnce() {
                audio.play();
                localStorage.setItem('isPlaying', 'true');
                console.log("Nh·∫°c b·∫Øt ƒë·∫ßu ph√°t sau khi ng∆∞·ªùi d√πng t∆∞∆°ng t√°c.");
                document.removeEventListener('click', playAudioOnce);
            });
        });
    }

    // L∆∞u l·∫°i th·ªùi gian ph√°t m·ªói gi√¢y ƒë·ªÉ ti·∫øp t·ª•c t·ª´ v·ªã tr√≠ hi·ªán t·∫°i
    setInterval(() => {
        if (!audio.paused) {
            localStorage.setItem('audioTime', audio.currentTime);
        }
    }, 1000);
});

// X√≥a tr·∫°ng th√°i khi nh·∫°c d·ª´ng ƒë·ªÉ ki·ªÉm so√°t l·∫°i khi t·∫£i trang
document.getElementById('bg-music').onpause = function() {
    localStorage.removeItem('isPlaying');
    localStorage.removeItem('audioTime');
};

// ƒê·∫£m b·∫£o tr·∫°ng th√°i nh·∫°c v·∫´n ti·∫øp t·ª•c khi ng∆∞·ªùi d√πng r·ªùi kh·ªèi trang v√† quay l·∫°i
window.addEventListener('beforeunload', () => {
    localStorage.setItem('isPlaying', 'true');
});


</script>
</body>
</html>
